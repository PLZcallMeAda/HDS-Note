The columns provide data on 
patient ID numbers (‘ID’), 
sex (‘SEX’), 
age (‘AGE’), 
age group (‘AGE_GRP’), 
diabetes (‘DIABETES’ (0=non-diabetic, 1=diabetic)), 
body mass index (‘BMIO’), 
smoking status (‘SMOKING’), 
systolic blood pressure (‘SYSTBP’) 收缩压（数值型，含 NA 缺失值）
and 
whether they experienced a cardiovascular event during follow-up (‘EVENT’ (1=yes, 0=no)).随访期心血管事件（1 = 发生，0 = 未发生）

### 模块 1：基于 SMART 数据集的基础分析（11 分）

围绕数据集的性别、吸烟状态、收缩压展开基础描述与统计推断，共 3 小问：

1. **a. 性别（SEX）与吸烟状态（SMOKING）的初步总结（2 分）**
    
    - 要求：用合适的描述性统计方法（如频数表、比例、条形图）呈现两个分类变量的分布特征；
    - 示例：统计男性 / 女性的人数及比例、吸烟者 / 非吸烟者的人数及比例，用条形图可视化两类人群分布。
2. **b. 收缩压（SYSTBP）的缺失值处理与分布分析（6 分）**
    
    - 步骤 1：删除收缩压中的 NA 值（缺失数据）；
    - 步骤 2：对清洗后的收缩压做初步总结（如均值、中位数、标准差、最小值、最大值，结合直方图 / 箱线图展示分布）；
    - 步骤 3：检验收缩压是否符合正态分布（如 Shapiro-Wilk 正态性检验、Q-Q 图可视化，需讨论检验结果：p 值是否 > 0.05，图形是否近似直线）。
3. **c. 收缩压总体均值的 95% 置信区间及解读（3 分）**
    
    - 步骤 1：基于清洗后的收缩压数据，计算样本均值（x̄）、样本标准差（s）、样本量（n）；
    - 步骤 2：用公式计算 95% 置信区间（若符合正态分布，用 t 分布或 z 分布，需说明选择依据）；
    - 步骤 3：判断区间是否包含 145（假设的总体平均收缩压），并解读：若包含，说明 “在 95% 置信水平下，总体平均收缩压可能为 145”；若不包含，则说明 “总体平均收缩压与 145 存在显著差异”。

### 模块 2：乳腺癌新疗法疗效的假设检验（14 分）

基于 “标准疗法治愈率 30%，新疗法测试 1000 例患者” 的场景，做理论统计计算，共 4 小问：

1. **a. 治愈人数的分布与假设设定（4 分）**
    
    - 分布判断：设 X 为新疗法治愈的患者数，X 服从二项分布 B (n=1000, p)，其中 p 为新疗法的真实治愈率；
    - 假设设定：
        - 原假设 H₀：新疗法治愈率不高于标准疗法，即 p=0.3；
        - 备择假设 H₁：新疗法治愈率高于标准疗法，即 p>0.3（单侧检验）。
2. **b. 基于中心极限定理的 I 类错误概率计算（4 分）**
    
    - 核心：I 类错误是 “H₀为真时，错误拒绝 H₀” 的概率，即 “p=0.3 时，X≥330” 的概率；
    - 步骤：用中心极限定理将二项分布近似为正态分布（N (μ=np=300, σ²=np (1-p)=210)），计算 P (X≥330)（需连续性修正），该概率即为 I 类错误概率；
    - 解读：结果表示 “当新疗法实际与标准疗法疗效相同时，错误判定新疗法更优的概率”。
3. **c. 真实治愈率为 0.35 时的检验功效（2 分）**
    
    - 核心：功效是 “H₁为真时，正确拒绝 H₀” 的概率，即 “p=0.35 时，X≥330” 的概率；
    - 步骤：将 X 近似为正态分布 N (μ=np=350, σ²=np (1-p)=227.5)，计算 P (X≥330)；
    - 解读：结果表示 “当新疗法真实治愈率为 35% 时，能正确检测出其优于标准疗法的概率”。
4. **d. 400 例治愈时的 p 值与结论（4 分）**
    
    - 步骤：H₀为 p=0.3 时，X=400，用正态近似计算 P (X≥400)（单侧 p 值）；
    - 结论：若 p 值 < 0.05（常用显著性水平），则拒绝 H₀，认为新疗法治愈率显著高于标准疗法；反之则不拒绝 H₀。

### 模块 3：基于 SMART 数据集的比例与关联分析（11 分）

围绕 “男性患者比例” 和 “性别与心血管事件的关联” 展开检验，共 2 小问：

1. **a. 男性患者总体比例的假设检验（4 分）**
    
    - 假设设定：H₀：总体男性患者比例 p=0.5；H₁：p≠0.5（双侧检验）；
    - 步骤：计算样本中男性比例（p̂）、样本量（n），用单样本比例检验（z 检验）计算 z 统计量和 p 值；
    - 结论：根据 p 值判断是否拒绝 H₀，若 p<0.05，说明总体男性患者比例显著不等于 0.5。
2. **b. 性别与心血管事件的比值比（OR）及关联检验（7 分）**
    
    - 步骤 1：构建性别（SEX）与心血管事件（EVENT）的 2×2 列联表（如男性 / 女性中发生 / 未发生事件的人数）；
    - 步骤 2：计算 OR 值（性别与事件的关联强度，OR=1 表示无关联，OR>1 表示某性别事件风险更高）；
    - 步骤 3：做卡方独立性检验（或 Fisher 精确检验，需说明选择依据），判断性别与事件是否存在统计关联；
    - 解读：OR 值的实际意义（如 OR=1.2 表示男性发生心血管事件的比值是女性的 1.2 倍），结合 p 值说明关联是否显著。

### 模块 4：基于 SMART 数据集的 BMI 差异检验（14 分）

围绕 “不同性别、不同年龄组的 BMI 差异” 展开检验，共 2 小问：

1. **a. 男性与女性的 BMI 差异检验（6 分）**
    
    - 方法选择：若 BMI 符合正态分布且两组方差齐，用独立样本 t 检验；否则用非参数检验（如 Mann-Whitney U 检验）；
    - 假设设定（以 t 检验为例）：
        - H₀：男性与女性的 BMI 总体均值相等（μ₁=μ₂）；
        - H₁：男性与女性的 BMI 总体均值不相等（μ₁≠μ₂，双侧检验）；
    - 步骤：先检验正态性（Shapiro-Wilk）和方差齐性（Levene 检验），再选择对应检验方法计算统计量和 p 值；
    - 结论：p<0.05 则认为男女 BMI 存在显著差异，同时结合 BMI 均值描述差异方向（如男性 BMI 均值高于女性）。
2. **b. 不同年龄组的 BMI 差异检验（8 分）**
    
    - 方法选择：多组间均值比较用单因素方差分析（ANOVA），前提是各组 BMI 正态分布且方差齐；否则用非参数检验（如 Kruskal-Wallis H 检验）；
    - 假设设定（以 ANOVA 为例）：
        - H₀：所有年龄组的 BMI 总体均值相等（μ₁=μ₂=…=μₖ，k 为年龄组数）；
        - H₁：至少有一个年龄组的 BMI 总体均值与其他组不同；
    - 步骤：先检验各组正态性和方差齐性，再做 ANOVA；若 ANOVA 显著（p<0.05），需做事后检验（如 Tukey HSD）定位具体哪两组存在差异；
    - 结论：结合检验结果说明年龄组间 BMI 是否存在显著差异，及差异存在于哪些组（如 “30-40 岁组 BMI 均值显著低于 60 岁以上组”）。
# 《数学与统计学基础 - 评估 1》四大模块任务详解（步骤 + 含义）

以下将逐模块拆解任务的每一步操作，结合 “统计逻辑 + 实际意义” 双维度解读，帮你明确 “做什么、为什么做、怎么做”，同时关联 SMART 数据集和乳腺癌疗法场景的核心需求。

## 模块 1：基于 SMART 数据集的基础分析（11 分）

**核心目标**：通过 “分类变量描述→连续变量清洗与分布检验→置信区间推断”，掌握数据预处理与基础统计描述的逻辑，为后续深入分析打基础。

### 1a. 性别（SEX）与吸烟状态（SMOKING）的初步总结（2 分）

#### 步骤 1：明确变量类型与取值

- 操作：先查看 SEX 和 SMOKING 的具体取值（用 R 代码`table(SMART$SEX)`或`unique(SMART$SMOKING)`），确认分类标准（如 SEX 是否为 1 = 男、0 = 女；SMOKING 是否为 1 = 吸烟、0 = 不吸烟）。
- 含义：分类变量的 “取值定义” 是后续统计的前提，若不明确取值，比例计算和图表会完全失去意义（比如误将 “2” 当作吸烟状态会导致数据错误）。

#### 步骤 2：计算频数与比例（描述核心特征）

- 操作：
    - 频数：用`table(SMART$SEX)`统计男性 / 女性的人数，`table(SMART$SMOKING)`统计吸烟者 / 非吸烟者人数；
    - 比例：用`prop.table(table(SMART$SEX))`计算男女比例（如男性占 45%、女性占 55%），同理计算吸烟比例。
- 含义：频数反映 “样本中各类别的数量规模”，比例反映 “类别分布的相对关系”，是分类变量最基础的描述指标（比如通过吸烟比例可初步判断样本是否以吸烟者为主）。

#### 步骤 3：可视化呈现（增强可读性）

- 操作：用`barplot()`画条形图（如 X 轴为性别，Y 轴为人数 / 比例；或分吸烟状态画性别分布），避免仅用数字表格。
- 含义：图表比文字更直观，能快速让读者看出 “性别是否均衡”“吸烟人群在不同性别中的分布差异”（比如女性吸烟比例是否低于男性）。

#### 关键逻辑：分类变量的描述核心是 “类别分布”，通过 “频数 + 比例 + 条形图” 三重呈现，确保信息完整且易理解。

### 1b. 收缩压（SYSTBP）的缺失值处理与分布分析（6 分）

#### 步骤 1：检测缺失值（数据清洗第一步）

- 操作：用`sum(is.na(SMART$SYSTBP))`统计收缩压的 NA 数量，用`mean(is.na(SMART$SYSTBP))`计算缺失比例（如缺失率 5%）。
- 含义：缺失值会导致后续分析样本量减少或结果偏差，需先明确缺失程度（若缺失率过高，需考虑是否放弃该变量或用其他方法填补，但题目明确要求 “删除缺失数据”）。

#### 步骤 2：删除缺失值（按题目要求处理）

- 操作：用`SMART_clean <- SMART[!is.na(SMART$SYSTBP), ]`生成删除 NA 后的数据集，或仅提取干净的收缩压向量`SYSTBP_clean <- na.omit(SMART$SYSTBP)`。
- 含义：确保后续分析用的是 “完整数据”，避免因 NA 导致统计函数报错（如`mean(SMART$SYSTBP)`会返回 NA，而`mean(SYSTBP_clean)`能得到有效均值）。

#### 步骤 3：连续变量的初步描述（核心统计量）

- 操作：用`summary(SYSTBP_clean)`获取均值、中位数、四分位数（Q1/Q3）、最小值、最大值；用`sd(SYSTBP_clean)`计算标准差。
- 含义：
    - 均值反映收缩压的 “平均水平”（如均值 138mmHg，说明样本平均收缩压为 138）；
    - 中位数用于判断分布是否对称（若均值≈中位数，可能近似正态；若差异大，可能偏态）；
    - 标准差反映 “数据离散程度”（如标准差 15，说明多数人收缩压在 138±15 范围内）；
    - 最值可初步判断是否有异常值（如收缩压 = 300mmHg 可能是录入错误，需结合箱线图确认）。

#### 步骤 4：可视化分布（直方图 + 箱线图）

- 操作：
    - 直方图：`hist(SYSTBP_clean, main="收缩压分布", xlab="收缩压(mmHg)")`，观察是否呈 “钟形”（正态分布的典型特征）；
    - 箱线图：`boxplot(SYSTBP_clean, ylab="收缩压(mmHg)")`，查看是否有异常值（超出上下须的点）。
- 含义：统计量是 “数字摘要”，图表是 “图形直观呈现”—— 比如直方图若左偏 / 右偏，说明收缩压分布不对称；箱线图的异常值需确认是否为真实数据（如题目未提异常值处理，可暂保留）。

#### 步骤 5：正态性检验（判断是否符合正态分布）

- 操作：用 Shapiro-Wilk 检验（`shapiro.test(SYSTBP_clean)`），若样本量极大（如 > 5000），可用 Kolmogorov-Smirnov 检验（但 Shapiro-Wilk 对大样本更敏感）。
- 含义：
    - 原假设 H₀：收缩压服从正态分布；备择假设 H₁：不服从正态分布；
    - 若 p 值 > 0.05（常用显著性水平），则 “不能拒绝 H₀”，认为收缩压近似正态；若 p<0.05，则认为不服从正态；
    - 为什么要检验？后续置信区间、t 检验等方法依赖正态分布假设，分布类型决定后续统计方法的选择（如非正态可能需用非参数方法）。

==I 类错误概率低（2.07%）是 “判定新疗法更好” 的 “前提保障”（保证我们不会轻易误判），但不是 “结论本身”。最终能不能得出 “新疗法更好” 的结论，关键看 “实际观测结果是否满足判定标准”—— 就像 “尺子准（α 低）是‘量出物体长度’的前提，但不能说‘尺子准，物体就一定长’，还要看‘用尺子量出来的结果到底是多少’”。==

#### 关键逻辑：连续变量的分析需遵循 “清洗→描述统计量→可视化→分布检验” 流程，核心是为后续推断统计（如置信区间、假设检验）确认 “数据是否符合方法前提”。

### 1c. 收缩压总体均值的 95% 置信区间及解读（3 分）

#### 步骤 1：提取核心统计量（计算前提）

- 操作：基于`SYSTBP_clean`，计算：
    - 样本量 n：`n <- length(SYSTBP_clean)`；
    - 样本均值 x̄：`x_bar <- mean(SYSTBP_clean)`；
    - 样本标准差 s：`s <- sd(SYSTBP_clean)`。
- 含义：置信区间是 “用样本统计量估计总体参数” 的工具，n、x̄、s 是估计的核心输入（x̄是总体均值的点估计，s 反映样本变异，n 影响估计精度）。

#### 步骤 2：选择置信区间公式（基于分布类型）

- 操作：
    - 若收缩压近似正态（1b 步骤 5 检验结果 p>0.05）：
        - 小样本（n<30）：用 t 分布，公式为`x_bar ± t_(α/2, n-1) * (s/√n)`（R 代码用`t.test(SYSTBP_clean)$conf.int`直接获取 95% CI）；
        - 大样本（n≥30）：用 z 分布（中心极限定理），公式为`x_bar ± 1.96 * (s/√n)`（1.96 是 95% 置信水平对应的 z 临界值）；
    - 若不服从正态但 n 极大（如 n>1000）：仍可用 z 分布（中心极限定理保障近似正态）。
- 含义：选择公式的核心是 “满足方法前提”——t 分布适用于 “总体标准差未知且样本小” 的情况，z 分布适用于 “大样本或总体标准差已知”，确保置信区间的估计是有效的。

#### 步骤 3：判断区间是否包含 145 并解读

- 操作：查看计算出的 95% CI（如 [136, 140]），判断 145 是否在区间内。
- 含义：
    - 若包含（如 CI=[142, 148]）：说明 “在 95% 的置信水平下，我们有理由认为收缩压的总体均值可能是 145”—— 即样本数据与 “总体均值为 145” 的假设无显著矛盾；
    - 若不包含（如 CI=[136, 140]）：说明 “在 95% 的置信水平下，总体均值不太可能是 145”—— 样本数据提示总体均值与 145 存在显著差异。
- 关键：置信区间的本质是 “总体参数的可能范围”，95% 置信水平表示 “重复抽样 100 次，有 95 次计算出的区间会包含真实总体均值”。

## 模块 2：乳腺癌新疗法疗效的假设检验（14 分）

**核心目标**：围绕 “二项分布→中心极限定理→I 类错误→功效→p 值”，掌握基于理论分布的假设检验逻辑，理解 “统计推断如何判断新疗法是否更优”。

### 2a. 治愈人数的分布与假设设定（4 分）

#### 步骤 1：判断 X 的分布类型（二项分布）

- 操作：明确 X 是 “1000 例患者中被新疗法治愈的人数”，需满足二项分布的 3 个条件：
    1. 独立试验：1000 例患者的治愈结果互不影响（题目隐含 “随机抽取”，满足独立性）；
    2. 固定试验次数：n=1000（固定）；
    3. 固定成功概率：每次试验 “治愈” 的概率为 p（新疗法的真实治愈率，未知）。
- 结论：X~B (n=1000, p)（X 服从参数为 n=1000 和 p 的二项分布）。
- 含义：分布类型决定后续计算的概率模型 —— 二项分布是 “离散型计数数据” 的常用模型，符合 “治愈 / 未治愈” 的二分类结果场景。

#### 步骤 2：设定研究假设（明确检验目标）

- 操作：根据 “检验新疗法是否比标准疗法（治愈率 0.3）更优” 的目标，设定：
    - 原假设 H₀：新疗法不优于标准疗法→p=0.3（即 “无差异” 假设，是检验的基准）；
    - 备择假设 H₁：新疗法优于标准疗法→p>0.3（单侧检验，因仅关心 “更高”，不关心 “更低”）。
- 含义：假设设定是假设检验的 “逻辑起点”——H₀代表 “现状 / 无效应”，H₁代表 “研究预期 / 有效应”，后续计算都是围绕 “是否有足够证据拒绝 H₀” 展开。

### 2b. 基于中心极限定理的 I 类错误概率计算（4 分）

#### 步骤 1：明确 I 类错误的定义（关键概念）

- 操作：I 类错误（假阳性错误）是 “当 H₀为真时，错误拒绝 H₀” 的概率，即 “新疗法实际治愈率 p=0.3（与标准疗法无差异），但错误判定其更优” 的概率。
- 题目中 “判定新疗法更优” 的标准是 “X≥330”，因此 I 类错误概率 = P (X≥330 | H₀为真)=P (X≥330 | p=0.3)。
- 含义：I 类错误是统计检验的 “风险上限”，通常控制在 α=0.05 以内，反映 “误判有效” 的可能性 —— 比如 I 类错误概率 = 0.02，说明 “新疗法实际无效时，误判为有效的概率仅 2%”。

#### 步骤 2：用中心极限定理近似正态分布（简化计算）

- 操作：二项分布 B (n,p) 在 n 较大时（通常 n≥30，且 np≥5、n (1-p)≥5），可近似为正态分布 N (μ=np, σ²=np (1-p))：
    - 当 H₀为真（p=0.3）时：
        - 均值 μ=np=1000×0.3=300；
        - 方差 σ²=np (1-p)=1000×0.3×0.7=210；
        - 标准差 σ=√210≈14.49。
- 含义：二项分布的概率计算（如 P (X≥330)）直接计算需求和 1000 次（P (X=330)+P (X=331)+…+P (X=1000)），极为繁琐；正态近似可将离散分布转为连续分布，用 Z 分数简化计算。

#### 步骤 3：连续性修正（离散→连续的必要调整）

- 操作：二项分布是离散型（X 取整数），正态分布是连续型，需修正边界值：P (X≥330)≈P (X≥329.5)（将整数 330 的下限调整为 329.5，避免概率遗漏）。
- 含义：若不修正，会导致近似误差偏大（比如直接用 330 计算，会低估实际概率），连续性修正是保证正态近似准确性的关键步骤。

#### 步骤 4：计算 Z 分数与 I 类错误概率

- 操作：
    - Z 分数公式：Z=(x - μ)/σ，代入 x=329.5、μ=300、σ≈14.49，得 Z=(329.5-300)/14.49≈2.04；
    - 查标准正态分布表（或用 R 代码`1-pnorm(2.04)`），得 P (Z≥2.04)≈0.0207（即 I 类错误概率≈2.07%）。
- 含义：结果表示 “当新疗法实际与标准疗法疗效相同时，错误判定其更优的概率约为 2.07%”—— 该风险低于常用的 α=0.05，说明检验的 “假阳性风险” 可控。

### 2c. 真实治愈率为 0.35 时的检验功效（2 分）

#### 步骤 1：明确功效的定义（关键概念）

- 操作：功效（Power）是 “当 H₁为真时，正确拒绝 H₀” 的概率，即 “新疗法真实治愈率 p=0.35（确实更优），且正确判定其更优” 的概率，公式为 Power=P (X≥330 | p=0.35)。
- 含义：功效反映检验的 “检测能力”—— 功效越高，说明 “新疗法实际有效时，能成功检测出的概率越高”，通常要求功效≥0.8（80%）。

#### 步骤 2：用正态近似计算功效

- 操作：
    - 当 p=0.35 时，二项分布近似正态分布 N (μ=np=1000×0.35=350, σ²=np (1-p)=1000×0.35×0.65=227.5, σ=√227.5≈15.08)；
    - 连续性修正：P (X≥330)≈P (X≥329.5)；
    - 计算 Z 分数：Z=(329.5-350)/15.08≈-1.36；
    - 查标准正态分布表（或用 R 代码`1-pnorm(-1.36)`），得 P (Z≥-1.36)=1-0.0869≈0.9131（即功效≈91.31%）。
- 含义：结果表示 “当新疗法真实治愈率为 35% 时，有 91.31% 的概率能正确检测出其优于标准疗法”—— 功效很高，说明该检验能有效识别新疗法的优势。

### 2d. 400 例治愈时的 p 值与结论（4 分）

#### 步骤 1：明确 p 值的定义（关键概念）

- 操作：p 值是 “在 H₀为真的前提下，观察到当前样本结果（X=400）或更极端结果（X≥400）的概率”，即 p 值 = P (X≥400 | H₀为真)=P (X≥400 | p=0.3)。
- 含义：p 值是 “反对 H₀的证据强度”——p 值越小，说明 “在 H₀为真时，观察到当前结果的可能性越低”，即越有理由拒绝 H₀。

#### 步骤 2：用正态近似计算 p 值

- 操作：
    - 基于 H₀（p=0.3）的正态分布参数：μ=300，σ≈14.49；
    - 连续性修正：P (X≥400)≈P (X≥399.5)；
    - 计算 Z 分数：Z=(399.5-300)/14.49≈6.87；
    - 查标准正态分布表（或用 R 代码`1-pnorm(6.87)`），得 P (Z≥6.87)≈0（p 值极小，远小于 0.05）。
- 含义：p 值极小，说明 “在新疗法与标准疗法无差异的前提下，观察到 400 例治愈的概率几乎为 0”—— 这是强烈反对 H₀的证据。

#### 步骤 3：基于 p 值得出结论

- 操作：设定显著性水平 α=0.05，若 p 值 <α，则拒绝 H₀；若 p 值≥α，则不拒绝 H₀。
- 结论：因 p 值≈0<0.05，拒绝 H₀，认为 “新疗法的治愈率显著高于标准疗法（30%）”。
- 含义：统计结论需结合实际场景 —— 该结果说明新疗法在 1000 例患者中治愈 400 例（治愈率 40%），远高于标准疗法，且这种差异不是由随机误差导致的。

## 模块 3：基于 SMART 数据集的比例与关联分析（11 分）

**核心目标**：通过 “单样本比例检验→分类变量关联（OR + 卡方检验）”，掌握分类变量的推断统计方法，理解 “如何判断样本比例是否符合总体假设”“两个分类变量是否存在关联”。

### 3a. 男性患者总体比例的假设检验（4 分）

#### 步骤 1：设定研究假设（明确检验目标）

- 操作：检验 “男性患者的总体比例是否为 0.5（即男女比例均衡）”，设定：
    - H₀：总体男性比例 p=0.5（无差异假设，即男女均衡）；
    - H₁：总体男性比例 p≠0.5（双侧检验，因关心 “是否不等于 0.5”，不限定方向）。
- 含义：该检验的核心是 “判断样本中男性比例与 0.5 的差异是否由随机误差导致”—— 比如样本男性比例 45%，需判断这 5% 的差异是 “随机波动” 还是 “总体确实不均衡”。

#### 步骤 2：计算样本统计量（检验输入）

- 操作：基于 SMART 数据集，计算：
    - 样本量 n：`n <- nrow(SMART)`（总患者数）；
    - 样本男性数 k：`k <- sum(SMART$SEX == 1, na.rm=TRUE)`（假设 SEX=1 为男性，需先确认取值）；
    - 样本男性比例 p̂：`p_hat <- k/n`（如 p̂=0.45）。
- 含义：p̂是总体比例 p 的 “点估计”，是检验的核心样本指标 —— 后续需判断 p̂与 H₀设定的 p=0.5 的差异是否显著。

#### 步骤 3：选择检验方法（单样本比例 z 检验）

- 操作：当 np≥5 且 n (1-p)≥5 时（H₀为真时 p=0.5，n 通常较大，满足条件），用单样本比例 z 检验，公式为：
    
    Z=(p̂ - p₀)/√(p₀(1-p₀)/n)
    
    其中 p₀=0.5（H₀设定的总体比例）。
- 用 R 代码直接实现：`prop.test(x=k, n=n, p=0.5, alternative="two.sided")`，获取 z 统计量和 p 值。
- 含义：比例 z 检验的核心是 “将样本比例 p̂标准化为 Z 分数”，通过 Z 分数判断 p̂与 p₀的差异是否超出 “随机误差范围”——Z 绝对值越大，p 值越小，越有理由拒绝 H₀。

#### 步骤 4：基于 p 值得出结论

- 操作：若 p 值 < 0.05（α=0.05），拒绝 H₀；否则不拒绝 H₀。
- 示例：若 p̂=0.45，n=1000，计算得 Z=(0.45-0.5)/√(0.5×0.5/1000)=-3.16，p 值≈0.0016<0.05，拒绝 H₀。
- 结论：“在 95% 的置信水平下，男性患者的总体比例显著不等于 0.5，即样本所在的总体中男女患者比例不均衡”。
- 含义：统计结论需结合实际 —— 比如该结果说明 SMART 研究的患者群体中女性多于男性，后续分析需考虑性别因素是否会影响其他变量（如心血管事件）。

### 3b. 性别与心血管事件的比值比（OR）及关联检验（7 分）

#### 步骤 1：构建 2×2 列联表（关联分析的基础）

- 操作：以 “性别（行）” 和 “心血管事件（列）” 为维度，构建交叉频数表：
    
    ||发生事件（EVENT=1）|未发生事件（EVENT=0）|合计|
    |---|---|---|---|
    |男性（SEX=1）|a（如 a=50）|b（如 b=450）|a+b|
    |女性（SEX=0）|c（如 c=30）|d（如 d=470）|c+d|
    |合计|a+c|b+d|n|
    
- 用 R 代码实现：`table(SMART$SEX, SMART$EVENT, useNA="ifany")`（排除 NA）。
- 含义：列联表是 “分类变量关联的直观呈现”—— 通过 a、b、c、d 的数值，可初步判断性别与事件的关系（如男性中事件发生率 a/(a+b)=10%，女性中 c/(c+d)=6%，初步提示男性事件风险更高）。

#### 步骤 2：计算比值比（OR）（关联强度指标）

- 操作：
    - 男性的 “事件比值”（发生 / 未发生）：OR_male = a/b（如 50/450≈0.111）；
    - 女性的 “事件比值”：OR_female = c/d（如 30/470≈0.064）；
    - 比值比 OR = OR_male / OR_female（如 0.111/0.064≈1.73）。
- 用 R 代码实现：`fisher.test(table(SMART$SEX, SMART$EVENT))$estimate`（或用`epiR`包的`epi.2by2`函数）。
- 含义：OR 是 “两个分类变量关联强度的核心指标”，解读规则：
    - OR=1：无关联（男性与女性的事件比值相同）；
    - OR>1：男性事件比值高于女性（即男性发生事件的风险更高，如 OR=1.73 表示男性事件比值是女性的 1.73 倍）；
    - OR<1：男性事件比值低于女性（女性风险更高）。
    - 注意：OR 是 “比值比”，不是 “风险比（RR）”，但在病例对照研究中常用 OR 近似 RR；本题是队列数据（随访观察事件发生），也可用 RR，但题目明确要求 OR，需按要求计算。

#### 步骤 3：关联的统计检验（卡方独立性检验）

- 操作：检验 “性别与心血管事件是否独立（无关联）”，设定：
    - H₀：性别与心血管事件独立（无关联，即 OR=1）；
    - H₁：性别与心血管事件不独立（有关联，即 OR≠1）；
- 用 R 代码实现：`chisq.test(table(SMART$SEX, SMART$EVENT))`，获取卡方统计量和 p 值（若有单元格期望频数 < 5，需用 Fisher 精确检验：`fisher.test(...)`）。
- 含义：卡方检验的核心是 “比较列联表的‘观察频数’与‘期望频数’（H₀为真时的理论频数）的差异”—— 若差异过大（卡方值大，p 值小），则拒绝 H₀，认为两者有关联。

#### 步骤 4：综合 OR 与 p 值解读结果

- 操作：结合 OR 值和 p 值，分两步解读：
    1. 关联强度：OR=1.73，说明男性发生心血管事件的比值是女性的 1.73 倍，提示男性风险更高；
    2. 统计显著性：若 p 值 = 0.02<0.05，拒绝 H₀，认为 “性别与心血管事件的关联具有统计显著性”—— 即这种关联不是由随机误差导致的。
- 示例结论：“在 SMART 数据集中，男性患者发生心血管事件的比值是女性的 1.73 倍（OR=1.73，95% CI：1.08-2.78，p=0.02），提示性别是心血管事件的潜在影响因素，男性风险更高”。
- 含义：统计关联≠因果关系 —— 该结果仅说明性别与心血管事件相关，不能直接认为 “男性导致心血管事件”，可能存在混杂因素（如男性吸烟比例更高、年龄更大）。

## 模块 4：基于 SMART 数据集的 BMI 差异检验（14 分）

**核心目标**：通过 “两独立样本差异检验（t 检验）→多独立样本差异检验（ANOVA）”，掌握连续变量在不同分组间的比较方法，理解 “如何判断两组 / 多组连续变量的均值是否存在显著差异”。

### 4a. 男性与女性的 BMI 差异检验（6 分）

#### 步骤 1：明确检验目标与假设设定

- 操作：检验 “男性与女性的 BMI 总体均值是否存在差异”，设定：
    - H₀：男性与女性的 BMI 总体均值相等（μ₁=μ₂，无差异假设）；
    - H₁：男性与女性的 BMI 总体均值不相等（μ₁≠μ₂，双侧检验）。
- 含义：BMI 是连续变量（数值型），该检验的核心是 “判断男女 BMI 均值的差异（如男性 BMI 均值 27，女性 25）是否由随机误差导致”—— 即差异是 “真实存在” 还是 “样本波动”。

#### 步骤 2：分组提取 BMI 数据（排除缺失值）

- 操作：基于 SMART 数据集，按性别分组提取 BMI，排除 NA：
    - 男性 BMI：`BMI_male <- SMART$BMIO[SMART$SEX == 1 & !is.na(SMART$BMIO)]`；
    - 女性 BMI：`BMI_female <- SMART$BMIO[SMART$SEX == 0 & !is.na(SMART$BMIO)]`。
- 含义：分组数据是检验的基础，需确保每组数据无缺失值（否则会影响均值计算和检验结果），同时记录两组样本量（n₁=length (BMI_male)，n₂=length (BMI_female)）。

#### 步骤 3：检验方法的前提假设（正态性 + 方差齐性）

- 操作：
    1. 正态性检验：分别对两组 BMI 做 Shapiro-Wilk 检验（`shapiro.test(BMI_male)`、`shapiro.test(BMI_female)`）；
        - 若两组 p 值均 > 0.05：认为两组 BMI 均近似正态；
        - 若任一组 p<0.05：认为该组 BMI 非正态，需用非参数检验（Mann-Whitney U 检验）；
    2. 方差齐性检验：若两组均正态，用 Levene 检验（`car::leveneTest(BMIO ~ SEX, data=SMART)`）；
        - 若 p>0.05：认为两组方差齐；
        - 若 p<0.05：认为方差不齐，需用 “方差不齐的 t 检验”（R 中`t.test(...)`的`var.equal=FALSE`）。
- 含义：前提假设是选择检验方法的关键 ——t 检验依赖 “正态分布” 和 “方差齐性”，若违反假设，t 检验结果会偏倚；非参数检验不依赖分布假设，适用于非正态数据。

#### 步骤 4：选择检验方法并计算结果

- 操作：
    - 若两组均正态且方差齐：用独立样本 t 检验（`t.test(BMI_male, BMI_female, var.equal=TRUE)`）；
    - 若两组均正态但方差不齐：用 Welch t 检验（`t.test(BMI_male, BMI_female, var.equal=FALSE)`）；
    - 若任一组非正态：用 Mann-Whitney U 检验（`wilcox.test(BMI_male, BMI_female)`，检验 “两组中位数是否存在差异”）；
- 从检验结果中提取 “统计量（t 值或 U 值）”“p 值”“两组均值（或中位数）”。
- 含义：检验方法的选择直接影响结果的有效性 —— 比如非正态数据用 t 检验，可能导致错误的 p 值，进而得出错误结论。

#### 步骤 5：基于结果解读差异

- 操作：结合 p 值和均值差异，分两步解读：
    1. 统计显著性：若 p<0.05，拒绝 H₀，认为男女 BMI 存在显著差异；否则不拒绝 H₀；
    2. 实际差异：描述两组均值（如男性 BMI 均值 27.2±3.5，女性 25.1±3.2），说明差异的方向和大小（如男性 BMI 平均比女性高 2.1 kg/m²）。
- 示例结论：“独立样本 t 检验显示，男性 BMI 均值（27.2±3.5）显著高于女性（25.1±3.2），t=5.82，df=980，p<0.001，说明在 SMART 研究中，男性的体重指数总体上显著高于女性”。
- 含义：实际差异需结合医学常识 —— 比如 2.1 kg/m² 的 BMI 差异是否有临床意义（通常 BMI 差异≥1.0 kg/m² 可能有一定意义），但题目仅要求统计检验，无需深入临床解读。

### 4b. 不同年龄组的 BMI 差异检验（8 分）

#### 步骤 1：明确检验目标与假设设定

- 操作：检验 “不同年龄组的 BMI 总体均值是否存在差异”（如年龄组分为 < 40 岁、40-60 岁、>60 岁），设定：
    - H₀：所有年龄组的 BMI 总体均值相等（μ₁=μ₂=μ₃=…=μₖ，k 为年龄组数，无差异假设）；
    - H₁：至少有一个年龄组的 BMI 总体均值与其他组不同（多组间存在差异）。
- 含义：该检验是 “单因素方差分析（ANOVA）” 的典型应用 —— 用于比较 “一个分类自变量（年龄组）” 与 “一个连续因变量（BMI）” 的关系，核心是 “判断多组均值的差异是否由分组因素（年龄）导致”。

#### 步骤 2：查看年龄组分类与分组数据

- 操作：
    1. 查看年龄组的取值与分布：`table(SMART$AGE_GRP, useNA="ifany")`，确认年龄组数量（如 k=3）和每组样本量（避免某组样本量过小，影响检验效力）；
    2. 分组提取 BMI 并排除 NA：`BMI_by_age <- split(SMART$BMIO, SMART$AGE_GRP)`，得到每个年龄组的 BMI 列表。
- 含义：分组数据需确保 “每组有足够样本量”（如每组 n≥5），且无 NA—— 样本量过小会导致 ANOVA 的检验效力降低，难以检测出真实差异。

#### 步骤 3：ANOVA 的前提假设检验（正态性 + 方差齐性）

- 操作：
    1. 正态性检验：对每个年龄组的 BMI 做 Shapiro-Wilk 检验（`lapply(BMI_by_age, shapiro.test)`）；
        - 若所有组 p 值均 > 0.05：认为各组 BMI 均近似正态；
        - 若任一组 p<0.05：认为该组 BMI 非正态，需用非参数检验（Kruskal-Wallis H 检验）；
    2. 方差齐性检验：若各组均正态，用 Levene 检验（`car::leveneTest(BMIO ~ AGE_GRP, data=SMART)`）；
        - 若 p>0.05：认为各组方差齐，可用常规 ANOVA；
        - 若 p<0.05：认为方差不齐，需用 “Welch ANOVA”（不要求方差齐，R 中`oneway.test(BMIO ~ AGE_GRP, data=SMART, var.equal=FALSE)`）。
- 含义：ANOVA 的核心假设是 “各组正态分布” 和 “方差齐性”—— 若违反，会导致 F 统计量偏倚，p 值不准确；非参数检验（Kruskal-Wallis）不依赖分布假设，适用于非正态或方差不齐的数据。

#### 步骤 4：执行 ANOVA 并判断整体差异

- 操作：
    - 若各组均正态且方差齐：用常规 ANOVA（`aov_result <- aov(BMIO ~ AGE_GRP, data=SMART)`，`summary(aov_result)`）；
    - 若各组均正态但方差不齐：用 Welch ANOVA（`oneway.test(BMIO ~ AGE_GRP, data=SMART, var.equal=FALSE)`）；
    - 若任一组非正态：用 Kruskal-Wallis H 检验（`kruskal.test(BMIO ~ AGE_GRP, data=SMART)`）；
- 从结果中提取 “统计量（F 值或 χ² 值）”“p 值”—— 若 p<0.05，拒绝 H₀，认为 “至少有一个年龄组的 BMI 均值与其他组不同”；否则不拒绝 H₀。
- 含义：ANOVA 的 “整体检验” 仅能判断 “多组间是否存在差异”，但无法确定 “具体哪两组存在差异”—— 若整体检验显著，需进一步做事后检验。

#### 步骤 5：事后检验（定位具体差异组）

- 操作：若 ANOVA/Welch ANOVA 显著（p<0.05），做事后检验：
    - 方差齐：用 Tukey HSD 检验（`TukeyHSD(aov_result)`），适用于 “所有组间两两比较”，能控制 I 类错误率；
    - 方差不齐：用 Games-Howell 检验（需加载`userfriendlyscience`包，`posthocTGH(BMIO ~ AGE_GRP, data=SMART)`）；
- 从结果中提取 “每组间的差异值”“p 值”—— 若某两组 p<0.05，说明这两组 BMI 均值存在显著差异。
- 含义：事后检验是 “多组比较的必要步骤”—— 比如 3 个年龄组的 ANOVA 显著，可能仅 “<40 岁组” 与 “>60 岁组” 存在差异，需通过事后检验明确。

#### 步骤 6：综合结果解读

- 操作：结合整体检验和事后检验结果，分三步解读：
    1. 整体差异：ANOVA 结果显示，不同年龄组的 BMI 总体均值存在显著差异（F=8.25，df1=2，df2=970，p<0.001）；
    2. 具体差异：Tukey HSD 检验显示，<40 岁组 BMI 均值（24.8±3.1）显著低于 40-60 岁组（26.5±3.3，p=0.002）和> 60 岁组（27.1±3.5，p<0.001），但 40-60 岁组与 > 60 岁组无显著差异（p=0.45）；
    3. 趋势描述（可选）：若存在线性趋势（如年龄越大，BMI 越高），可描述 “BMI 随年龄增长而升高的趋势”。
- 示例结论：“单因素方差分析显示，不同年龄组的 BMI 总体均值存在显著差异（F=8.25，p<0.001）。事后 Tukey HSD 检验表明，<40 岁组的 BMI 均值显著低于 40-60 岁组和> 60 岁组（p 均 < 0.01），而 40-60 岁组与 > 60 岁组的 BMI 均值无显著差异（p=0.45），提示 BMI 随年龄增长有升高趋势，尤其在 40 岁后更明显”。
- 含义：趋势描述能增强结果的可读性，但需基于数据实际情况 —— 若年龄组与 BMI 无明显趋势（如中间组最高），则无需强行描述趋势。

## 总结：四大模块的核心逻辑串联

1. **基础分析（模块 1）**：是所有统计的前提，通过 “数据清洗→描述统计→分布检验”，确保数据质量并为后续推断统计选择合适方法；
2. **理论检验（模块 2）**：聚焦 “二项分布 + 中心极限定理”，理解假设检验的核心概念（I 类错误、功效、p 值），掌握基于理论分布的计算逻辑；
3. **分类变量推断（模块 3）**：针对 “比例假设” 和 “变量关联”，用 “比例 z 检验”“卡方检验 + OR” 解决分类变量的统计推断问题；
4. **连续变量推断（模块 4）**：针对 “两组 / 多组均值差异”，用 “t 检验”“ANOVA” 解决连续变量的分组比较问题，核心是 “前提假设检验→方法选择→结果解读”。

所有模块的共同核心是 “**先明确目标→再设定假设→后选择方法→最后解读结果**”，且每一步都需结合数据类型和方法前提，确保统计分析的 “有效性” 和 “可解释性”—— 这也是评估评分中 “分析准确性” 和 “结果解读” 各占 50% 的原因。

要不要我帮你整理一份**各模块的 R 代码实操模板**？包含数据导入、预处理、检验执行、结果提取的完整代码，标注关键参数和解读要点，可直接适配 SMART 数据集使用。

编辑分享