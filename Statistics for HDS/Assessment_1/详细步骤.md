最好不截图
使用此网站来写代码
https://www.codeinword.com/

### 数据基本情况
```
# 查看数据结构 
str(Assessment1_data) 
# 查看数据维度 
dim(Assessment1_data) 
# 查看前几行数据 
head(Assessment1_data) 
# 检查缺失值 
sum(is.na(Assessment1_data)) 
colSums(is.na(Assessment1_data))
```
解释解释sum和colSum的区别
一个是统计所有，一个是统计每列
```r
#输出
> sum(is.na(Assessment1_data)) 
[1] 0
> colSums(is.na(Assessment1_data))
           X Diabetes_012     HighChol    CholCheck          BMI 
           0            0            0            0            0 
      Smoker       Stroke          Sex          Age     MentHlth 
           0            0            0            0            0 
```
### 1.2 描述性统计分析

#### 分类变量总结（糖尿病状态、高胆固醇、吸烟状态等）：


```r
# 分类变量的频数统计
library(dplyr)
library(tidyr)

# 对所有分类变量进行频数和百分比统计
lapply(categorical_vars, function(var_name) {
     # 提取当前变量的数据，过滤缺失值
     Assessment1_data %>% 
         select(all_of(var_name)) %>%  # 选择当前分类变量，这里为什么用all_of，不加的话会把var_name当成参数，也就是先挑选这一列
         filter(!is.na(.data[[var_name]])) %>%  # 去除缺失值
         count(.data[[var_name]], name = "frequency") %>%  # 统计每个类别的频数
         mutate(
             percentage = (frequency / sum(frequency)) * 100,  # 计算百分比（替代multiply_by(100)）
             percentage = round(percentage, 1)  # 保留1位小数
         ) %>% 
         rename(!!var_name := .data[[var_name]])  # 把“分类值列”改回原变量名
 })
 
# %>%是管道，写成这样也可以select(Assessment1_data, all_of(var_name))


# 加载必要包
library(ggplot2)
library(dplyr)

# 数据整理（保持正确的标签生成逻辑）
plot_data <- bind_rows(
  discrete_freq_list[[1]] %>% mutate(variable = "Diabetes_012", category = factor(Diabetes_012, levels = c(0, 1))),
  discrete_freq_list[[2]] %>% mutate(variable = "HighChol", category = factor(HighChol, levels = c(0, 1))),
  discrete_freq_list[[3]] %>% mutate(variable = "CholCheck", category = factor(CholCheck, levels = c(0, 1))),
  discrete_freq_list[[4]] %>% mutate(variable = "Smoker", category = factor(Smoker, levels = c(0, 1))),
  discrete_freq_list[[5]] %>% mutate(variable = "Stroke", category = factor(Stroke, levels = c(0, 1))),
  discrete_freq_list[[6]] %>% mutate(variable = "Sex", category = factor(Sex, levels = c(0, 1)))
) %>%
  mutate(
    # 保持你确认正确的标签生成逻辑
    category_label = case_when(
      variable == "Diabetes_012" ~ ifelse(category == 0, "No Diabetes", "Has Diabetes"),
      variable == "HighChol"     ~ ifelse(category == 0, "No High Chol", "Has High Chol"),
      variable == "CholCheck"    ~ ifelse(category == 0, "No Check", "Had Check"),
      variable == "Smoker"       ~ ifelse(category == 0, "Non-smoker", "Smoker"),
      variable == "Stroke"       ~ ifelse(category == 0, "No Stroke", "Had Stroke"),
      variable == "Sex"          ~ ifelse(category == 0, "Female", "Male"),
      TRUE ~ as.character(category)
    )
  )

# 直接使用已生成的category_label作为x轴标签（关键修正）
ggplot(plot_data, aes(x = category_label, y = frequency, fill = factor(category))) +
  geom_bar(stat = "identity", color = "black", width = 0.8) +
  
  geom_text(
    aes(label = frequency),
    vjust = -0.3,
    size = 3.5,
    fontface = "bold"
  ) +
  
  facet_wrap(~ variable, scales = "free_x", ncol = 3) +
  
  labs(
    title = "Frequency Distributions of Discrete Variables",
    x = NULL,
    y = "Frequency",
    fill = NULL
  ) +
  
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    strip.text = element_text(face = "bold", size = 10),
    legend.position = "none",
    axis.text.x = element_text(
      angle = 45,
      hjust = 1,
      vjust = 1,
      size = 8,
      margin = margin(t = 10, unit = "pt")
    ),
    axis.text.y = element_text(size = 10)
  ) +
  scale_fill_manual(values = c("dodgerblue4", "coral")) +
  expand_limits(y = max(plot_data$frequency) * 1.1) +
  scale_y_continuous(labels = scales::comma_format())


```
输出
```r
[[1]]
  Diabetes_012 frequency percentage
1            0    213703       84.2
2            1     39977       15.8

[[2]]
  HighChol frequency percentage
1        0    146089       57.6
2        1    107591       42.4

[[3]]
  CholCheck frequency percentage
1         0      9470        3.7
2         1    244210       96.3

[[4]]
  Smoker frequency percentage
1      0    141257       55.7
2      1    112423       44.3

[[5]]
  Stroke frequency percentage
1      0    243388       95.9
2      1     10292        4.1

[[6]]
  Sex frequency percentage
1   0    141974         56
2   1    111706         44
```

![[Rplot05.pdf]]




这一步不要了：
```r
# 制作分类变量的频数表
sapply(Assessment1_data[categorical_vars], function(x) {
  data.frame(
    frequency = table(x),
    percentage = prop.table(table(x)) * 100
  )
})
    
```

```r
#输出
                Diabetes_012 HighChol  CholCheck Smoker   
frequency.x     factor,2     factor,2  factor,2  factor,2 
frequency.Freq  integer,2    integer,2 integer,2 integer,2
percentage.x    factor,2     factor,2  factor,2  factor,2 
percentage.Freq numeric,2    numeric,2 numeric,2 numeric,2
                Stroke    Sex      
frequency.x     factor,2  factor,2 
frequency.Freq  integer,2 integer,2
percentage.x    factor,2  factor,2 
percentage.Freq numeric,2 numeric,2
```

这里涉及动态引用变量名的一些知识
## 这 3 种方式的共同目标和区别

| 语法                  | 适用函数                  | 核心作用        | 关键差异                             |
| ------------------- | --------------------- | ----------- | -------------------------------- |
| `all_of(var_name)`  | `select()`            | 按字符串变量选列    | 仅用于 `select()` 等 `tidyselect` 函数 |
| `.data[[var_name]]` | `filter()`、`count()`等 | 按字符串变量提取列值  | 用于需要 “引用列中数据” 的场景                |
| `!!var_name`        | `rename()`等           | 把字符串变量转成列名本 |                                  |
#### 连续变量总结（BMI、年龄、心理健康天数）：

```r帆f g g g g g f f f f f f f f c c
# 连续变量的描述性统计
continuous_vars <- c("BMI", "Age", "MentHlth")

# 获取基础统计量（包含最小值、四分位数、中位数、均值、最大值）
base_stats <- summary(Assessment1_data[continuous_vars])

# 单独计算标准差
sd_stats <- sapply(Assessment1_data[continuous_vars], sd, na.rm = TRUE)

# 将标准差添加到结果中，命名为"SD"
combined_stats <- rbind(base_stats, "SD" = sd_stats)

# 输出合并后的统计结果
print(combined_stats)
```
```
输出
```r
      BMI             Age           MentHlth     
 Min.   :12.00   Min.   :18.00   Min.   : 0.000  
 1st Qu.:24.00   1st Qu.:51.66   1st Qu.: 0.000  
 Median :27.00   Median :66.39   Median : 0.000  
 Mean   :28.22   Mean   :63.19   Mean   : 3.185  
 3rd Qu.:31.00   3rd Qu.:76.96   3rd Qu.: 2.000  
 Max.   :54.44   Max.   :93.00   Max.   :30.000  head
```



```r

```
### 1.3 可视化分析

#### 分类变量可视化：

r

```r
# Bar chart of diabetes prevalence
ggplot(Assessment1_data, aes(x = factor(Diabetes_012))) +
  geom_bar(fill = "dodgerblue4") +
  labs(title = "Distribution of Diabetes Status", 
       x = "Diabetes Status (0=No, 1=Yes)", 
       y = "Number of People") +
  theme_classic()

# Bar chart of smoker proportion
ggplot(Assessment1_data, aes(x = factor(Smoker))) +
  geom_bar(fill = "coral") +
  labs(title = "Distribution of Smoking Status", 
       x = "Smoking Status (0=Non-smoker, 1=Smoker)", 
       y = "Number of People") +
  theme_classic()

```
![[Rplot.pdf]]
#### ![[Rplot01.pdf]]
三个连续变量可视化：
直方图

```r

# Histogram of BMI distribution
ggplot(Assessment1_data, aes(x = BMI)) +
  geom_histogram(binwidth = 2, fill = "green", color = "black", alpha = 0.7) +
  labs(title = "BMI Distribution", x = "BMI (kg/m²)", y = "Frequency") +
  theme_classic()

# Histogram of age distribution
ggplot(Assessment1_data, aes(x = Age)) +
  geom_histogram(binwidth = 5, fill = "purple", color = "black", alpha = 0.7) +
  labs(title = "Age Distribution", x = "Age (years)", y = "Frequency") +
  theme_classic()
  
# Histogram of MentHlth

ggplot(Assessment1_data, aes(x = factor(MentHlth))) +  # 转换为因子，让每个整数对应一个柱子
  geom_bar(fill = "yellow", color = "black", alpha = 0.7) +
  labs(
    title = "mental health issues (past 30 days)", 
    x = "Days with mental health issues", 
    y = "Frequency"
  ) +
  theme_classic() +
  # 调整x轴标签角度，避免拥挤
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

  
# Box plot comparison of continuous variables by diabetes status
ggplot(Assessment1_data, aes(x = factor(Diabetes_012), y = BMI)) +
  geom_boxplot(fill = "yellow", alpha = 0.7) +
  labs(title = "BMI Distribution by Diabetes Status", 
       x = "Diabetes Status (0=No, 1=Yes)", 
       y = "BMI (kg/m²)") +
  theme_classic()
```

![[Rplot02.pdf]]
![[Rplot03.pdf]]

![[Rplot06.pdf]]

核密度图：
```r
# 1. BMI的核密度图
# Kernel Density Plot for BMI
ggplot(Assessment1_data, aes(x = BMI)) +
  geom_density(fill = "green", color = "darkgreen", alpha = 0.5) +  # 绿色系
  labs(
    title = "Kernel Density of BMI Distribution",
    x = "BMI (kg/m²)",
    y = "Density"
  ) +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
    axis.title = element_text(face = "bold")
  )

# 2. 年龄的核密度图
# Kernel Density Plot for Age
ggplot(Assessment1_data, aes(x = Age)) +
  geom_density(fill = "purple", color = "darkorchid", alpha = 0.5) +  # 紫色系
  labs(
    title = "Kernel Density of Age Distribution",
    x = "Age (years)",
    y = "Density"
  ) +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
    axis.title = element_text(face = "bold")
  )

# 3. 心理健康天数的核密度图
# Kernel Density Plot for MentHlth
ggplot(Assessment1_data, aes(x = MentHlth)) +
  geom_density(fill = "yellow", color = "goldenrod", alpha = 0.5) +  # 黄色系
  labs(
    title = "Kernel Density of Mental Health Days",
    x = "Days with mental health issues",
    y = "Density"
  ) +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
    axis.title = element_text(face = "bold")
  )

```

![[Rplot07.pdf]]
![[Rplot08.pdf]]
![[Rplot09.pdf]]


qq图
```r

library(ggplot2)
library(dplyr)

# 1. BMI的QQ图
ggplot(Assessment1_data, aes(sample = BMI)) +
  stat_qq() +
  stat_qq_line() +
  labs(
    title = "QQ Plot of BMI",
    x = "Theoretical Quantiles",
    y = "Sample Quantiles"
  ) +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
    axis.title = element_text(face = "bold")
  )

# 2. 年龄的QQ图
ggplot(Assessment1_data, aes(sample = Age)) +
  stat_qq() +
  stat_qq_line() +
  labs(
    title = "QQ Plot of Age",
    x = "Theoretical Quantiles",
    y = "Sample Quantiles"
  ) +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
    axis.title = element_text(face = "bold")
  )

# 3. 心理健康天数的QQ图
ggplot(Assessment1_data, aes(sample = MentHlth)) +
  stat_qq() +
  stat_qq_line() +
  labs(
    title = "QQ Plot of Mental Health Days",
    x = "Theoretical Quantiles",
    y = "Sample Quantiles"
  ) +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 12, face = "bold"),
    axis.title = element_text(face = "bold")
  )
```
![[Rplot10.pdf]]

![[Rplot11.pdf]]

![[Rplot12.pdf]]

箱线图之间的比较

### 箱线图解读：

1. **糖尿病状态与 BMI 箱线图**
    
    - 中位数比较：若糖尿病患者 (1 组) 的 BMI 中位数高于非患者 (0 组)，说明糖尿病与较高体重指数相关
    - 分布对称性：观察箱体是否对称（中位数线是否在箱体中央）和上下须线长度。若接近对称，表明 BMI 在两组中均接近正态分布；若明显不对称，可能存在偏态分布
2. **高胆固醇状态与年龄箱线图**
    
    - 中位数比较：通常高胆固醇患者 (1 组) 的年龄中位数会高于非患者 (0 组)，反映年龄增长与高胆固醇的关联
    - 分布特征：若箱体对称且须线长度均衡，说明年龄分布接近正态；若老年患者较多，可能使箱体上半部分拉长
3. **中风史与心理健康天数箱线图**
    
    - 中位数比较：若有中风史 (1 组) 的患者心理健康问题天数中位数更高，提示中风可能与心理健康问题相关
    - 分布形态：心理健康天数通常呈右偏分布（多数人天数少，少数人天数多），箱体可能呈现不对称特征
4. **吸烟状态与 BMI 箱线图**
    
    - 中位数比较：可观察吸烟者与非吸烟者在体重指数上的差异，揭示吸烟与体重的潜在关联
    - 离散程度：箱体宽度反映数据分散性，宽度越大说明该群体内 BMI 差异越大

```r
# 加载必要库
library(ggplot2)
library(dplyr)

# 定义统一的对比色（浅绿色和绿色）
color_palette <- c("#B5EAD7", "#4CAF50")  # 浅绿色和绿色

# 1. 糖尿病状态与BMI的箱线图
ggplot(Assessment1_data, aes(x = factor(Diabetes_012), y = BMI, fill = factor(Diabetes_012))) +
  geom_boxplot(width = 0.6, outlier.size = 1.5) +
  labs(
    title = "BMI Distribution by Diabetes Status",
    x = "Diabetes Status (0=No, 1=Yes)",
    y = "BMI (kg/m²)",
    fill = "Diabetes Status"
  ) +
  scale_fill_manual(values = color_palette) +  # 使用统一配色
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 12),
    axis.title = element_text(face = "bold")
  )

# 2. 高胆固醇状态与年龄的箱线图
ggplot(Assessment1_data, aes(x = factor(HighChol), y = Age, fill = factor(HighChol))) +
  geom_boxplot(width = 0.6, outlier.size = 1.5) +
  labs(
    title = "Age Distribution by High Cholesterol Status",
    x = "High Cholesterol (0=No, 1=Yes)",
    y = "Age (years)",
    fill = "High Cholesterol"
  ) +
  scale_fill_manual(values = color_palette) +  # 使用统一配色
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 12),
    axis.title = element_text(face = "bold")
  )

# 3. 中风史与心理健康天数的箱线图
ggplot(Assessment1_data, aes(x = factor(Stroke), y = MentHlth, fill = factor(Stroke))) +
  geom_boxplot(width = 0.6, outlier.size = 1.5) +
  labs(
    title = "Mental Health Days by Stroke History",
    x = "Stroke History (0=No, 1=Yes)",
    y = "Days with Mental Health Issues",
    fill = "Stroke History"
  ) +
  scale_fill_manual(values = color_palette) +  # 使用统一配色
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 12),
    axis.title = element_text(face = "bold")
  )

# 4. 吸烟状态与BMI的箱线图
ggplot(Assessment1_data, aes(x = factor(Smoker), y = BMI, fill = factor(Smoker))) +
  geom_boxplot(width = 0.6, outlier.size = 1.5) +
  labs(
    title = "BMI Distribution by Smoking Status",
    x = "Smoking Status (0=Non-smoker, 1=Smoker)",
    y = "BMI (kg/m²)",
    fill = "Smoking Status"
  ) +
  scale_fill_manual(values = color_palette) +  # 使用统一配色
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 12),
    axis.title = element_text(face = "bold")
  )
    
```

![[Rplot13.pdf]]
![[Rplot14.pdf]]
![[Rplot15.pdf]]

![[Rplot16.pdf]]


**分组柱状图（带误差线）**，用于比较不同分组（这里是糖尿病状态：`Diabetes_012`的 0 组和 1 组）在多个连续变量（`Age`、`BMI`、`MentHlth`）上的均值及误差（通常是标准差或标准误）。

```r

library(ggplot2)
library(dplyr)
library(tidyr)

# 数据预处理
plot_data <- Assessment1_data %>%
  select(Diabetes_012, Age, BMI, MentHlth) %>%
  group_by(Diabetes_012) %>%
  summarize(
    Age_mean = mean(Age, na.rm = TRUE),
    Age_sd = sd(Age, na.rm = TRUE),
    BMI_mean = mean(BMI, na.rm = TRUE),
    BMI_sd = sd(BMI, na.rm = TRUE),
    MentHlth_mean = mean(MentHlth, na.rm = TRUE),
    MentHlth_sd = sd(MentHlth, na.rm = TRUE)
  ) %>%
  pivot_longer(
    cols = -Diabetes_012,
    names_to = c("variable", ".value"),
    names_pattern = "(.*)_(mean|sd)"
  ) %>%
  mutate(
    Diabetes_012 = factor(Diabetes_012, levels = c(0, 1)),
    variable = factor(variable, levels = c("Age", "BMI", "MentHlth")),
    variable_label = case_when(
      variable == "Age" ~ "Age (years)",
      variable == "BMI" ~ "BMI (kg/m²)",
      variable == "MentHlth" ~ "Mental Health Days"
    )
  )

# 定义颜色
color_palette <- c("#B5EAD7", "#4CAF50")

# 绘图（仅保留fill的图例，移除color的重复图例）
ggplot(plot_data, aes(x = variable_label, y = mean, fill = Diabetes_012)) +
  geom_col(position = position_dodge(width = 0.8), width = 0.7) +
  geom_errorbar(
    aes(ymin = mean - sd, ymax = mean + sd, color = Diabetes_012),  # 仅color映射误差线
    position = position_dodge(width = 0.8),
    width = 0.2,
    linewidth = 1.2,
    show.legend = FALSE  # 误差线不显示图例
  ) +
  geom_text(
    aes(label = round(mean, 1)),
    position = position_dodge(width = 0.8),
    vjust = -0.8,
    size = 3.5,
    fontface = "bold",
    color = "black"
  ) +
  labs(
    title = "Health Indicators by Diabetes Status",
    x = NULL,
    y = "Mean Value",
    fill = "Diabetes Status"
  ) +
  scale_fill_manual(values = color_palette, labels = c("No Diabetes", "Has Diabetes")) +
  scale_color_manual(values = color_palette) +  # 仅用于误差线颜色，不显示图例
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
    axis.title.y = element_text(face = "bold", size = 12),
    axis.text.x = element_text(size = 10, face = "italic"),
    legend.position = "bottom",
    legend.title = element_text(face = "bold")
  ) +
  expand_limits(y = max(plot_data$mean + plot_data$sd) * 1.2)

```
![[Rplot18.pdf]]

散点图反映了**糖尿病状态（有无糖尿病）与年龄、BMI 之间的分布关系**

```r

library(ggplot2)
library(dplyr)

# 数据处理
plot_data <- Assessment1_data %>%
  mutate(
    Diabetes_012 = factor(
      Diabetes_012, 
      levels = c(0, 1),
      labels = c("0", "1")  # 匹配示例图的标签
    )
  )

# 颜色设置（匹配第一张图的红和青）
color_palette <- c("#F4A086", "#80CBC4")  # 红色系和青色系

# 绘制仅有点的散点图
ggplot(plot_data, aes(x = Age, y = BMI, color = Diabetes_012)) +
  geom_point(size = 2, alpha = 0.7) +  # 仅保留点，移除趋势线
  labs(
    title = "BMI and Age by Diabetes Status",
    x = "Age",
    y = "BMI",
    color = "Diabetes"  # 匹配示例图图例标题
  ) +
  scale_color_manual(values = color_palette) +
  theme_classic() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold"),
    axis.title = element_text(face = "bold"),
    legend.position = "right"
  )

```

![[Rplot19.pdf]]### 分组分布（颜色区分糖尿病状态）

- 红色点代表**无糖尿病人群（Diabetes=0）**，青色点代表**有糖尿病人群（Diabetes=1）**。
- 无糖尿病人群在各年龄段的 BMI 分布更广泛，从低 BMI（10-20）到高 BMI（50+）都有覆盖；而有糖尿病人群的 BMI 集中在**30-50 区间**，低 BMI 的分布明显更少。

### 2. 年龄与 BMI 的关联

- 整体来看，**年龄越大，BMI 的集中区间越高**。例如，20 岁左右人群 BMI 多在 20-30，而 80 岁左右人群 BMI 多在 30-50。
- 有糖尿病人群的这一趋势更明显：在高龄段（60-80 岁），有糖尿病者的 BMI 普遍高于无糖尿病者。

### 3. 疾病与健康指标的关联

- 有糖尿病人群的 BMI “高值聚集性” 更强，暗示**高 BMI 可能是糖尿病的风险因素**（或糖尿病与肥胖存在共现性）。
- 无糖尿病人群在低 BMI 区间（10-20）仍有一定分布，而有糖尿病人群几乎没有，说明低 BMI 人群患糖尿病的概率更低。

简言之，这张图直观展示了 “年龄越大、BMI 越高的人群，患糖尿病的概率可能越高” 的趋势，也体现了糖尿病与高 BMI 之间的潜在关联。




## 任务 2：与去年筛查结果的比较分析（15 分）

去年的筛查结果显示：

- 14% 的参与者患有糖尿病
- 平均 BMI 为 28 kg/m²
- 平均年龄为 55 岁
- 吸烟与糖尿病之间存在显著关联

我们需要验证当前数据集是否支持这些结论。

### 2.1 糖尿病患病率比较

**假设设定**：

- H₀：当前数据集中糖尿病患病率等于 14%（p = 0.14）
- H₁：当前数据集中糖尿病患病率不等于 14%（p ≠ 0.14）

r

```r
# 计算当前数据集中的糖尿病患病率
diabetes_prevalence <- mean(Assessment1_data$Diabetes_012 == 1, na.rm = TRUE) * 100
cat("当前数据集中的糖尿病患病率:", round(diabetes_prevalence, 1), "%\n")

# 进行单样本比例检验
diabetes_count <- sum(Assessment1_data$Diabetes_012 == 1, na.rm = TRUE)
total_count <- sum(!is.na(Assessment1_data$Diabetes_012))
prop_test_result <- prop.test(diabetes_count, total_count, p = 0.14)
print(prop_test_result)

# 解读结果：
# 如果p值 < 0.05，则拒绝原假设，认为当前患病率与14%有显著差异
# 如果p值 >= 0.05，则不拒绝原假设，认为当前患病率与14%无显著差异
```

### 2.2 平均 BMI 比较

**假设设定**：

- H₀：当前数据集中参与者的平均 BMI 等于 28 kg/m²（μ = 28）
- H₁：当前数据集中参与者的平均 BMI 不等于 28 kg/m²（μ ≠ 28）

r

```r
# 计算当前数据集中的平均BMI
mean_bmi <- mean(Assessment1_data$BMI, na.rm = TRUE)
cat("当前数据集中的平均BMI:", round(mean_bmi, 1), "kg/m²\n")

# 检查BMI的正态性（t检验的前提）
shapiro.test(Assessment1_data$BMI[!is.na(Assessment1_data$BMI)])

# 绘制Q-Q图检查正态性
qqnorm(Assessment1_data$BMI[!is.na(Assessment1_data$BMI)])
qqline(Assessment1_data$BMI[!is.na(Assessment1_data$BMI)])

# 进行单样本t检验（如果数据近似正态分布）
t_test_bmi <- t.test(Assessment1_data$BMI, mu = 28, na.rm = TRUE)
print(t_test_bmi)

# 如果数据严重偏离正态分布，使用wilcoxon符号秩检验
# wilcox_test_bmi <- wilcox.test(Assessment1_data$BMI - 28, mu = 0, na.rm = TRUE)
# print(wilcox_test_bmi)
```

### 2.3 平均年龄比较

**假设设定**：

- H₀：当前数据集中参与者的平均年龄等于 55 岁（μ = 55）
- H₁：当前数据集中参与者的平均年龄不等于 55 岁（μ ≠ 55）

r

```r
# 计算当前数据集中的平均年龄
mean_age <- mean(Assessment1_data$Age, na.rm = TRUE)
cat("当前数据集中的平均年龄:", round(mean_age, 1), "岁\n")

# 检查年龄的正态性
shapiro.test(Assessment1_data$Age[!is.na(Assessment1_data$Age)])

# 进行单样本t检验
t_test_age <- t.test(Assessment1_data$Age, mu = 55, na.rm = TRUE)
print(t_test_age)
```

### 2.4 吸烟与糖尿病的关联分析

**假设设定**：

- H₀：吸烟状态与糖尿病状态之间无关联（独立）
- H₁：吸烟状态与糖尿病状态之间有关联（不独立）

r

```r
# 创建列联表
smoke_diabetes_table <- table(
  吸烟状态 = factor(Assessment1_data$Smoker, levels = c(0, 1), labels = c("不吸烟", "吸烟")),
  糖尿病状态 = factor(Assessment1_data$Diabetes_012, levels = c(0, 1), labels = c("无糖尿病", "有糖尿病"))
)
print(smoke_diabetes_table)

# 计算不同吸烟状态下的糖尿病患病率
smoke_diabetes_prop <- prop.table(smoke_diabetes_table, margin = 1) * 100
print(smoke_diabetes_prop)

# 可视化吸烟与糖尿病的关系
barplot(smoke_diabetes_prop, 
        beside = TRUE, 
        col = c("lightblue", "salmon"),
        main = "不同吸烟状态下的糖尿病患病率",
        ylab = "患病率 (%)",
        legend.text = rownames(smoke_diabetes_prop))

# 进行卡方独立性检验
# 检查期望频数是否满足条件（所有单元格期望频数 >= 5）
chisq_test <- chisq.test(smoke_diabetes_table)
print(chisq_test)

# 如果期望频数不满足条件，使用Fisher精确检验
# fisher_test <- fisher.test(smoke_diabetes_table)
# print(fisher_test)
```

## 结果解释与讨论要点

对于每个分析结果，你需要：

1. **陈述统计结果**：简明扼要地呈现 p 值、统计量等
2. **解释统计结论**：是否拒绝原假设，为什么
3. **联系实际意义**：将统计结果转化为糖尿病筛查项目的实际含义
4. **讨论可能的解释**：为什么会出现这样的结果，可能的原因是什么
5. **考虑局限性**：分析方法的假设是否满足，可能存在的偏差等

例如，对于吸烟与糖尿病的关联分析，你的讨论可以包括：

- 统计结果是否显示显著关联
- 吸烟者的糖尿病患病率比不吸烟者高（或低）多少
- 这种关联在公共卫生层面有什么意义
- 可能存在哪些混杂因素需要考虑
- 本分析的局限性是什么

## 报告撰写注意事项

1. **结构清晰**：使用标题、小标题组织内容，确保逻辑流畅
2. **图表规范**：所有图表都应有清晰的标题和轴标签，避免过多使用颜色
3. **解释充分**：不仅呈现结果，还要解释结果的含义和重要性
4. **代码整合**：R 代码可以放在附录，但重要的分析步骤应在正文中描述
5. **语言专业**：使用统计学和医学的专业术语，但确保解释通俗易懂
6. **控制篇幅**：不超过 10 页，字体不小于 11 号，使用标准页边距

通过以上步骤，你将能够完成一份全面、专业的数据分析报告，既展示你对单变量分布、抽样分布和假设检验的理解，又能满足评估的各项要求。


你需撰写一份报告总结所收集的数据，并完成以下两项任务：
1. Please provide a summary of the data, with the aid of graphs and tables (5 marks)
2. ==借助图表和表格，对数据进行概况总结（5 分）==
3. Another screening programme took place last year in a different region and they found 14% of individuals had diabetes and the average BMI and age of those attending clinics were 28kg/m² and 55 years, respectively.
4. ==去年在另一地区开展过一项筛查项目，结果显示 14% 的参与者患有糖尿病，参与诊所筛查人员的平均 BMI（体重指数）为 28 千克 / 平方米，平均年龄为 55 岁。==
==They also found a significant relationship between smoking and diabetes.==
==该项目还发现，吸烟与糖尿病之间存在显著关联。==

|              |                                                                                                                                                                   |
| ------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Diabetes_012 | Weather the patient was diagnosed with diabetes (0 = no-diabetes, 1 = diabetes)患者是否被诊断出患有糖尿病（0=无糖尿病，1=有糖尿病）                                                       |
| HighChol     | Whether the patient has high cholesterol (0 = no, 1 = yes)患者是否有高胆固醇（0=否，1=是）                                                                                      |
| CholCheck    | Whether the patient had cholesterol checked (0 = no, 1 = yes)患者是否检查过胆固醇（0=否，1=是）                                                                                  |
| BMI          | Body mass index (kg/m2)体重指数（千克/平方米）                                                                                                                               |
| Smoker       | Whether the patient is a smoker (0 = non-smoker, 1 = smoker)患者是否为吸烟者（0=不吸烟者，1=吸烟者）                                                                                |
| Stroke       | Whether the patient has ever had a stroke (0 = no, 1 = yes)患者是否曾患中风（0=否，1=是）                                                                                      |
| Sex          | Sex of the patient, binary (0 = female, 1 = male)患者性别，二元（0 = 女性，1 = 男性）                                                                                           |
| Age          | Age of patient in years患者的年龄（以年为单位）                                                                                                                               |
| MentHlth     | Number of days in the past 30 days the patient says they have suffered with mental health (including stress, depression, etc)过去30天里，患者表示自己遭受心理健康问题（包括压力、抑郁等）困扰的天数 |



