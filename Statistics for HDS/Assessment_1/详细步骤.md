最好不截图


### 数据基本情况
```
# 查看数据结构 
str(Assessment1_data) 
# 查看数据维度 
dim(Assessment1_data) 
# 查看前几行数据 
head(Assessment1_data) 
# 检查缺失值 
sum(is.na(Assessment1_data)) 
colSums(is.na(Assessment1_data))
```
解释解释sum和colSum的区别
一个是统计所有，一个是统计每列
```r
#输出
> sum(is.na(Assessment1_data)) 
[1] 0
> colSums(is.na(Assessment1_data))
           X Diabetes_012     HighChol    CholCheck          BMI 
           0            0            0            0            0 
      Smoker       Stroke          Sex          Age     MentHlth 
           0            0            0            0            0 
```
### 1.2 描述性统计分析

#### 分类变量总结（糖尿病状态、高胆固醇、吸烟状态等）：


```r
# 分类变量的频数统计
library(dplyr)
library(tidyr)

# 对所有分类变量进行频数和百分比统计
lapply(categorical_vars, function(var_name) {
     # 提取当前变量的数据，过滤缺失值
     Assessment1_data %>% 
         select(all_of(var_name)) %>%  # 选择当前分类变量，这里为什么用all_of，不加的话会把var_name当成参数，也就是先挑选这一列
         filter(!is.na(.data[[var_name]])) %>%  # 去除缺失值
         count(.data[[var_name]], name = "frequency") %>%  # 统计每个类别的频数
         mutate(
             percentage = (frequency / sum(frequency)) * 100,  # 计算百分比（替代multiply_by(100)）
             percentage = round(percentage, 1)  # 保留1位小数
         ) %>% 
         rename(!!var_name := .data[[var_name]])  # 把“分类值列”改回原变量名
 })
 
# %>%是管道，写成这样也可以select(Assessment1_data, all_of(var_name))
```
输出
```r
[[1]]
  Diabetes_012 frequency percentage
1            0    213703       84.2
2            1     39977       15.8

[[2]]
  HighChol frequency percentage
1        0    146089       57.6
2        1    107591       42.4

[[3]]
  CholCheck frequency percentage
1         0      9470        3.7
2         1    244210       96.3

[[4]]
  Smoker frequency percentage
1      0    141257       55.7
2      1    112423       44.3

[[5]]
  Stroke frequency percentage
1      0    243388       95.9
2      1     10292        4.1

[[6]]
  Sex frequency percentage
1   0    141974         56
2   1    111706         44
```

```r
# 制作分类变量的频数表
sapply(Assessment1_data[categorical_vars], function(x) {
  data.frame(
    frequency = table(x),
    percentage = prop.table(table(x)) * 100
  )
})
    
```

```r
#输出
                Diabetes_012 HighChol  CholCheck Smoker   
frequency.x     factor,2     factor,2  factor,2  factor,2 
frequency.Freq  integer,2    integer,2 integer,2 integer,2
percentage.x    factor,2     factor,2  factor,2  factor,2 
percentage.Freq numeric,2    numeric,2 numeric,2 numeric,2
                Stroke    Sex      
frequency.x     factor,2  factor,2 
frequency.Freq  integer,2 integer,2
percentage.x    factor,2  factor,2 
percentage.Freq numeric,2 numeric,2
```

这里涉及动态引用变量名的一些知识
## 这 3 种方式的共同目标和区别

| 语法                  | 适用函数                  | 核心作用        | 关键差异                             |
| ------------------- | --------------------- | ----------- | -------------------------------- |
| `all_of(var_name)`  | `select()`            | 按字符串变量选列    | 仅用于 `select()` 等 `tidyselect` 函数 |
| `.data[[var_name]]` | `filter()`、`count()`等 | 按字符串变量提取列值  | 用于需要 “引用列中数据” 的场景                |
| `!!var_name`        | `rename()`等           | 把字符串变量转成列名本 |                                  |
#### 连续变量总结（BMI、年龄、心理健康天数）：

```r
# 连续变量的描述性统计
continuous_vars <- c("BMI", "Age", "MentHlth")
summary(Assessment1_data[continuous_vars])
```
输出
```r
      BMI             Age           MentHlth     
 Min.   :12.00   Min.   :18.00   Min.   : 0.000  
 1st Qu.:24.00   1st Qu.:51.66   1st Qu.: 0.000  
 Median :27.00   Median :66.39   Median : 0.000  
 Mean   :28.22   Mean   :63.19   Mean   : 3.185  
 3rd Qu.:31.00   3rd Qu.:76.96   3rd Qu.: 2.000  
 Max.   :54.44   Max.   :93.00   Max.   :30.000  head
```

```r
# Calculate descriptive statistics for continuous variables separately and combine results

# Define continuous variables
continuous_vars <- c("BMI", "Age", "MentHlth")

# Extract the continuous variables from the dataset
continuous_data <- Assessment1_data[continuous_vars]

# 1. Calculate mean for each variable
means <- sapply(continuous_data, function(col) {
  mean(col, na.rm = TRUE)
})

# 2. Calculate standard deviation for each variable
sds <- sapply(continuous_data, function(col) {
  sd(col, na.rm = TRUE)
})

# 3. Calculate minimum value for each variable
mins <- sapply(continuous_data, function(col) {
  min(col, na.rm = TRUE)
})

# 4. Calculate 25th percentile (first quartile) for each variable
q25 <- sapply(continuous_data, function(col) {
  quantile(col, 0.25, na.rm = TRUE)
})

# 5. Calculate median (50th percentile) for each variable
medians <- sapply(continuous_data, function(col) {
  median(col, na.rm = TRUE)
})

# 6. Calculate 75th percentile (third quartile) for each variable
q75 <- sapply(continuous_data, function(col) {
  quantile(col, 0.75, na.rm = TRUE)
})

# 7. Calculate maximum value for each variable
maxs <- sapply(continuous_data, function(col) {
  max(col, na.rm = TRUE)
})

# Combine all statistics into a single data frame
stats_summary <- data.frame(
  Statistic = c("Mean", "SD", "Min", "25th Percentile", "Median", "75th Percentile", "Max"),
  BMI = c(means["BMI"], sds["BMI"], mins["BMI"], q25["BMI"], medians["BMI"], q75["BMI"], maxs["BMI"]),
  Age = c(means["Age"], sds["Age"], mins["Age"], q25["Age"], medians["Age"], q75["Age"], maxs["Age"]),
  MentHlth = c(means["MentHlth"], sds["MentHlth"], mins["MentHlth"], q25["MentHlth"], medians["MentHlth"], q75["MentHlth"], maxs["MentHlth"])
)

# Print the combined result
print(stats_summary)
    
```
输出
```r

```
### 1.3 可视化分析

#### 分类变量可视化：

r

```r
library(ggplot2)

# 糖尿病患病率条形图
ggplot(Assessment1_data, aes(x = factor(Diabetes_012))) +
  geom_bar(fill = "steelblue") +
  labs(title = "糖尿病患病情况分布", 
       x = "糖尿病状态 (0=无, 1=有)", 
       y = "人数") +
  theme_minimal()

# 吸烟者比例条形图
ggplot(Assessment1_data, aes(x = factor(Smoker))) +
  geom_bar(fill = "coral") +
  labs(title = "吸烟者分布", 
       x = "吸烟状态 (0=不吸烟, 1=吸烟)", 
       y = "人数") +
  theme_minimal()
```

#### 连续变量可视化：

r

```r
# BMI分布直方图
ggplot(Assessment1_data, aes(x = BMI)) +
  geom_histogram(binwidth = 2, fill = "green", color = "black", alpha = 0.7) +
  labs(title = "BMI分布", x = "BMI (kg/m²)", y = "频数") +
  theme_minimal()

# 年龄分布直方图
ggplot(Assessment1_data, aes(x = Age)) +
  geom_histogram(binwidth = 5, fill = "purple", color = "black", alpha = 0.7) +
  labs(title = "年龄分布", x = "年龄 (岁)", y = "频数") +
  theme_minimal()

# 连续变量箱线图比较（按糖尿病状态）
ggplot(Assessment1_data, aes(x = factor(Diabetes_012), y = BMI)) +
  geom_boxplot(fill = "yellow", alpha = 0.7) +
  labs(title = "不同糖尿病状态下的BMI分布", 
       x = "糖尿病状态 (0=无, 1=有)", 
       y = "BMI (kg/m²)") +
  theme_minimal()
```

## 任务 2：与去年筛查结果的比较分析（15 分）

去年的筛查结果显示：

- 14% 的参与者患有糖尿病
- 平均 BMI 为 28 kg/m²
- 平均年龄为 55 岁
- 吸烟与糖尿病之间存在显著关联

我们需要验证当前数据集是否支持这些结论。

### 2.1 糖尿病患病率比较

**假设设定**：

- H₀：当前数据集中糖尿病患病率等于 14%（p = 0.14）
- H₁：当前数据集中糖尿病患病率不等于 14%（p ≠ 0.14）

r

```r
# 计算当前数据集中的糖尿病患病率
diabetes_prevalence <- mean(Assessment1_data$Diabetes_012 == 1, na.rm = TRUE) * 100
cat("当前数据集中的糖尿病患病率:", round(diabetes_prevalence, 1), "%\n")

# 进行单样本比例检验
diabetes_count <- sum(Assessment1_data$Diabetes_012 == 1, na.rm = TRUE)
total_count <- sum(!is.na(Assessment1_data$Diabetes_012))
prop_test_result <- prop.test(diabetes_count, total_count, p = 0.14)
print(prop_test_result)

# 解读结果：
# 如果p值 < 0.05，则拒绝原假设，认为当前患病率与14%有显著差异
# 如果p值 >= 0.05，则不拒绝原假设，认为当前患病率与14%无显著差异
```

### 2.2 平均 BMI 比较

**假设设定**：

- H₀：当前数据集中参与者的平均 BMI 等于 28 kg/m²（μ = 28）
- H₁：当前数据集中参与者的平均 BMI 不等于 28 kg/m²（μ ≠ 28）

r

```r
# 计算当前数据集中的平均BMI
mean_bmi <- mean(Assessment1_data$BMI, na.rm = TRUE)
cat("当前数据集中的平均BMI:", round(mean_bmi, 1), "kg/m²\n")

# 检查BMI的正态性（t检验的前提）
shapiro.test(Assessment1_data$BMI[!is.na(Assessment1_data$BMI)])

# 绘制Q-Q图检查正态性
qqnorm(Assessment1_data$BMI[!is.na(Assessment1_data$BMI)])
qqline(Assessment1_data$BMI[!is.na(Assessment1_data$BMI)])

# 进行单样本t检验（如果数据近似正态分布）
t_test_bmi <- t.test(Assessment1_data$BMI, mu = 28, na.rm = TRUE)
print(t_test_bmi)

# 如果数据严重偏离正态分布，使用wilcoxon符号秩检验
# wilcox_test_bmi <- wilcox.test(Assessment1_data$BMI - 28, mu = 0, na.rm = TRUE)
# print(wilcox_test_bmi)
```

### 2.3 平均年龄比较

**假设设定**：

- H₀：当前数据集中参与者的平均年龄等于 55 岁（μ = 55）
- H₁：当前数据集中参与者的平均年龄不等于 55 岁（μ ≠ 55）

r

```r
# 计算当前数据集中的平均年龄
mean_age <- mean(Assessment1_data$Age, na.rm = TRUE)
cat("当前数据集中的平均年龄:", round(mean_age, 1), "岁\n")

# 检查年龄的正态性
shapiro.test(Assessment1_data$Age[!is.na(Assessment1_data$Age)])

# 进行单样本t检验
t_test_age <- t.test(Assessment1_data$Age, mu = 55, na.rm = TRUE)
print(t_test_age)
```

### 2.4 吸烟与糖尿病的关联分析

**假设设定**：

- H₀：吸烟状态与糖尿病状态之间无关联（独立）
- H₁：吸烟状态与糖尿病状态之间有关联（不独立）

r

```r
# 创建列联表
smoke_diabetes_table <- table(
  吸烟状态 = factor(Assessment1_data$Smoker, levels = c(0, 1), labels = c("不吸烟", "吸烟")),
  糖尿病状态 = factor(Assessment1_data$Diabetes_012, levels = c(0, 1), labels = c("无糖尿病", "有糖尿病"))
)
print(smoke_diabetes_table)

# 计算不同吸烟状态下的糖尿病患病率
smoke_diabetes_prop <- prop.table(smoke_diabetes_table, margin = 1) * 100
print(smoke_diabetes_prop)

# 可视化吸烟与糖尿病的关系
barplot(smoke_diabetes_prop, 
        beside = TRUE, 
        col = c("lightblue", "salmon"),
        main = "不同吸烟状态下的糖尿病患病率",
        ylab = "患病率 (%)",
        legend.text = rownames(smoke_diabetes_prop))

# 进行卡方独立性检验
# 检查期望频数是否满足条件（所有单元格期望频数 >= 5）
chisq_test <- chisq.test(smoke_diabetes_table)
print(chisq_test)

# 如果期望频数不满足条件，使用Fisher精确检验
# fisher_test <- fisher.test(smoke_diabetes_table)
# print(fisher_test)
```

## 结果解释与讨论要点

对于每个分析结果，你需要：

1. **陈述统计结果**：简明扼要地呈现 p 值、统计量等
2. **解释统计结论**：是否拒绝原假设，为什么
3. **联系实际意义**：将统计结果转化为糖尿病筛查项目的实际含义
4. **讨论可能的解释**：为什么会出现这样的结果，可能的原因是什么
5. **考虑局限性**：分析方法的假设是否满足，可能存在的偏差等

例如，对于吸烟与糖尿病的关联分析，你的讨论可以包括：

- 统计结果是否显示显著关联
- 吸烟者的糖尿病患病率比不吸烟者高（或低）多少
- 这种关联在公共卫生层面有什么意义
- 可能存在哪些混杂因素需要考虑
- 本分析的局限性是什么

## 报告撰写注意事项

1. **结构清晰**：使用标题、小标题组织内容，确保逻辑流畅
2. **图表规范**：所有图表都应有清晰的标题和轴标签，避免过多使用颜色
3. **解释充分**：不仅呈现结果，还要解释结果的含义和重要性
4. **代码整合**：R 代码可以放在附录，但重要的分析步骤应在正文中描述
5. **语言专业**：使用统计学和医学的专业术语，但确保解释通俗易懂
6. **控制篇幅**：不超过 10 页，字体不小于 11 号，使用标准页边距

通过以上步骤，你将能够完成一份全面、专业的数据分析报告，既展示你对单变量分布、抽样分布和假设检验的理解，又能满足评估的各项要求。


你需撰写一份报告总结所收集的数据，并完成以下两项任务：
1. Please provide a summary of the data, with the aid of graphs and tables (5 marks)
2. ==借助图表和表格，对数据进行概况总结（5 分）==
3. Another screening programme took place last year in a different region and they found 14% of individuals had diabetes and the average BMI and age of those attending clinics were 28kg/m² and 55 years, respectively.
4. ==去年在另一地区开展过一项筛查项目，结果显示 14% 的参与者患有糖尿病，参与诊所筛查人员的平均 BMI（体重指数）为 28 千克 / 平方米，平均年龄为 55 岁。==
==They also found a significant relationship between smoking and diabetes.==
==该项目还发现，吸烟与糖尿病之间存在显著关联。==

|              |                                                                                                                                                                   |
| ------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Diabetes_012 | Weather the patient was diagnosed with diabetes (0 = no-diabetes, 1 = diabetes)患者是否被诊断出患有糖尿病（0=无糖尿病，1=有糖尿病）                                                       |
| HighChol     | Whether the patient has high cholesterol (0 = no, 1 = yes)患者是否有高胆固醇（0=否，1=是）                                                                                      |
| CholCheck    | Whether the patient had cholesterol checked (0 = no, 1 = yes)患者是否检查过胆固醇（0=否，1=是）                                                                                  |
| BMI          | Body mass index (kg/m2)体重指数（千克/平方米）                                                                                                                               |
| Smoker       | Whether the patient is a smoker (0 = non-smoker, 1 = smoker)患者是否为吸烟者（0=不吸烟者，1=吸烟者）                                                                                |
| Stroke       | Whether the patient has ever had a stroke (0 = no, 1 = yes)患者是否曾患中风（0=否，1=是）                                                                                      |
| Sex          | Sex of the patient, binary (0 = female, 1 = male)患者性别，二元（0 = 女性，1 = 男性）                                                                                           |
| Age          | Age of patient in years患者的年龄（以年为单位）                                                                                                                               |
| MentHlth     | Number of days in the past 30 days the patient says they have suffered with mental health (including stress, depression, etc)过去30天里，患者表示自己遭受心理健康问题（包括压力、抑郁等）困扰的天数 |



